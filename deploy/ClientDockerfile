FROM node:12.16.2
LABEL MAINTAINER="Mark Thomsit <mark@makeandship.com>"
LABEL MAINTAINER="Yassire Elhani <yassire@makeandship.com>"

ENV NPM_CONFIG_PREFIX=/home/node/.npm-global
ENV PATH=$PATH:/home/node/.npm-global/bin

# server installation directory
WORKDIR /home/node/app
RUN mkdir /home/node/.npm-global

# push this app to the deployment directory
ADD web /home/node/app/web
ADD node_modules /home/node/app/node_modules

RUN chown -R node:node /home/node/.npm-global
RUN chown -R node:node /home/node/app

USER node

# run local client on 3000
EXPOSE 3000

# run up the server
# CMD node /home/node/app/dist/index.js
CMD FOREVER_ROOT=/home/node/data/forever NODE_ENV=$NODE_ENV /home/node/app/node_modules/.bin/forever -l /home/node/data/logs/forever.log -o /home/node/data/logs/out.log -e /home/node/data/logs/err.log /home/node/app/web/dist/index.js

# Arguments
#ARG NODE_ENV
#ENV NODE_ENV=$NODE_ENV
#ARG HOST
#ENV HOST=$HOST
#ARG PORT
#ENV PORT=$PORT
#ARG DEBUG_PRODUCTION
#ENV DEBUG_PRODUCTION=$DEBUG_PRODUCTION
#ARG API_DEBUG
#ENV API_DEBUG=$API_DEBUG
#ARG ATLAS_APP
#ENV ATLAS_APP=$ATLAS_APP
#ARG API_URL
#ENV API_URL=$API_URL
#ARG AUTH_COOKIE_NAME
#ENV AUTH_COOKIE_NAME=$AUTH_COOKIE_NAME
#ARG API_SWAGGER_URL
#ENV API_SWAGGER_URL=$API_SWAGGER_URL
#ARG GOOGLE_MAPS_API_KEY
#ENV GOOGLE_MAPS_API_KEY=$GOOGLE_MAPS_API_KEY
#ARG BOX_CLIENT_ID
#ENV BOX_CLIENT_ID=$BOX_CLIENT_ID
#ARG DROPBOX_APP_KEY
#ENV DROPBOX_APP_KEY=$DROPBOX_APP_KEY
#ARG GOOGLE_DRIVE_CLIENT_ID
#ENV GOOGLE_DRIVE_CLIENT_ID=$GOOGLE_DRIVE_CLIENT_ID
#ARG GOOGLE_DRIVE_DEVELOPER_KEY
#ENV GOOGLE_DRIVE_DEVELOPER_KEY=$GOOGLE_DRIVE_DEVELOPER_KEY
#ARG ONEDRIVE_CLIENT_ID
#ENV ONEDRIVE_CLIENT_ID=$ONEDRIVE_CLIENT_ID
#ARG AUTH_KEYCLOAK_URL
#ENV AUTH_KEYCLOAK_URL=$AUTH_KEYCLOAK_URL
#ARG AUTH_KEYCLOAK_REALM
#ENV AUTH_KEYCLOAK_REALM=$AUTH_KEYCLOAK_REALM
#ARG AUTH_KEYCLOAK_CLIENT_ID
#ENV AUTH_KEYCLOAK_CLIENT_ID=$AUTH_KEYCLOAK_CLIENT_ID
